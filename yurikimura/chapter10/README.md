# 第10章: 機械翻訳
本章では，日本語と英語の翻訳コーパスである[京都フリー翻訳タスク (KFTT)](http://www.phontron.com/kftt/index-ja.html)を用い，ニューラル機械翻訳モデルを構築する．ニューラル機械翻訳モデルの構築には，[fairseq](https://github.com/facebookresearch/fairseq)，[Hugging Face Transformers](https://github.com/huggingface/transformers)，[OpenNMT-py](https://github.com/OpenNMT/OpenNMT-py)などの既存のツールを活用せよ．


## 京都フリー翻訳タスク (KFTT) 一部抜粋

京都フリー翻訳タスク(KFTT)は、日英機械翻訳システムのための評価タスクです。タスクはフリー、簡単、再現性のある、進化型の機械翻訳タスクを目指して設立されました。

### データの詳細
#### 京都関連文書対訳コーパス
京都フリー翻訳タスクは京都関連のWikipedia記事を対象とした翻訳タスクです。

日英翻訳のデータであり、翻訳と添削はプロの翻訳者により作成されています。日英翻訳は言語間の文法等の違いにより特に難しいと言われています。
専門分野の百科事典であり、翻字や英語に存在しない概念の意訳など、今までのタスクにあまり現れない現象がたくさん含まれています。

### データ加工
このデータを機械翻訳に利用しやすくするために、いくつかの加工を行いました。

1. 機械翻訳システムが利用できる形式への抽出。
2. 機械翻訳システムMosesのスクリプトを用いた英語のトークン化、KyTeaを用いた日本語の単語分割。KyTeaのモデルは京都文書に軽く分野適応されており、データと一緒に配布されています。
3. データを学習(train)・重み学習(tune)・開発テスト(dev)・本番テスト(test)の4セットの作成。基本的には学習データはモデルのパラメータの学習に利用し、重み学習でパラメータのチューニングを行い、開発テストを開発時の評価に利用し、本番テストを最終的なスコアを報告するために利用します。
4. さらに、学習データから0単語の文や非常に長い(40単語以上)の文を除き、整理済みの学習データを作成しました。

データのサイズは以下の通りです(ver. 1.0)：

記事数	文数	単語数(日)	単語数(英)
学習	14126	440k	12.0M	11.5M
学習(整理済み)	14126	330k	6.09M	5.91M
重み学習	15	1235	34.4k	30.8k
開発テスト	15	1166	26.8k	24.3k
本テスト	15	1160	28.5k	26.7k
入手・使用法


### 入手・使用法
#### データ+ベースラインシステム
京都フリー翻訳タスクで機械翻訳のベースラインシステムを作るために、３つのステップを行わなければなりません。まず、
1. データをダウンロード
2. ソフトウェアをインストール
3. スクリプトを動かしてデータとベースラインシステムを作成

##### データとスクリプト
現在のベースラインは[KFTT Moses Baseline, v. 1.4]()と[KFTT lader, v. 1.0]()です。前者は通常のMosesによるフレーズベース翻訳、後者は前並べ替え器laderを導入したものです。laderを使った方が高い精度が実現できるが、計算量を要します。
次は、ベースラインシステムの作成に利用するソフトをインストールします。

GIZA++：単語アライメントのツール。
Moses：フレーズベース翻訳のデコーダ。
SRILM：言語モデルのツールキット。
KyTea：日本語の単語分割ツール。
MT helper scripts機械翻訳に利用するスクリプト。


さらに、２つの環境変数を設定します：

**SCRIPTS_ROOTDIR**はMosesのスクリプトをインストールした場所に設定します（参照）。
**MT_SCRIPTS**はMT helper scriptsをインストールした場所に設定します。


以上のソフトがインストールし終わったら、KFTTの.tar.gzファイルを解凍し、process.shを実行します。また、以上のソフトを普段と違う場所にインストールしていれば、process.shの先頭にある変数を変更し、ソフトの場所を指定する必要があるかもしれません。データの抽出とベースラインシステムの学習は計算時間とメモリを多く費やします(それぞれ約20時間と数GB）ので、ご注意ください。

```
$ tar -xzf kfft-XXX.tar.gz
$ cd kfft-XXX
$ nohup ./process.sh &> process.log &
```

スクリプトの処理が終わったら、process.logの最後にベースラインシステムのBLEUスコアが表示され、本ページに載っているスコアに合っていることを確認してください。スクリプトの実行がうまくいかない場合はご連絡ください。


#### データのみ
京都フリー翻訳タスクで研究を行う際はなるべくベースラインシステムを構築することをおすすめしますが、データのみを以下のリンクからダウンロードすることもできます：

Kyoto Free Translation Task (Data Only v. 1.0)

#### 単語アライメントデータ
単語アライメントの精度評価や教師ありアライメント法の学習に利用可能な単語アライメントデータです。全てのアライメントは２名の作業者によって作成され、最後に一貫性チェックされたものです。データ自体は重み学習データの1235文となっています。

Kyoto Free Translation Task - 日英単語アライメントデータ




参考 https://qiita.com/nymwa/items/867e05a43060d036a174
